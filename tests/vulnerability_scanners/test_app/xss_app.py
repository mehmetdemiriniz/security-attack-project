"""
XSS test web uygulaması
"""
from flask import Flask, request, render_template_string

app = Flask(__name__)

# HTML şablonları
HTML_TEMPLATE = """
<!DOCTYPE html>
<html>
<head>
    <title>XSS Test</title>
    <style>
        body { background-color: {{ style_input }}; }
    </style>
    <script>
        var userInput = '{{ script_input }}';
        console.log(userInput);
    </script>
</head>
<body>
    <h1>XSS Test Sayfası</h1>
    
    <!-- HTML bağlamı -->
    <div>{{ html_input }}</div>
    
    <!-- Öznitelik bağlamı -->
    <input type="text" value="{{ attr_input }}">
    
    <!-- URL bağlamı -->
    <a href="{{ url_input }}">Test Link</a>
    
    <!-- DOM tabanlı XSS -->
    <div id="content"></div>
    <script>
        // URL fragment'ını DOM'a ekle
        document.getElementById('content').innerHTML = location.hash.substring(1);
        
        // URL parametresini DOM'a ekle
        var urlParams = new URLSearchParams(window.location.search);
        var domInput = urlParams.get('dom_input');
        if (domInput) {
            document.write(domInput);
        }
    </script>
</body>
</html>
"""

@app.route("/")
def index():
    """Ana sayfa - tüm XSS vektörlerini test et"""
    return render_template_string(
        HTML_TEMPLATE,
        html_input=request.args.get('html_input', ''),
        attr_input=request.args.get('attr_input', ''),
        script_input=request.args.get('script_input', ''),
        style_input=request.args.get('style_input', 'white'),
        url_input=request.args.get('url_input', '#')
    )

@app.route("/reflected")
def reflected_xss():
    """Reflected XSS test endpoint'i"""
    user_input = request.args.get('input', '')
    return f"<div>Girdiğiniz değer: {user_input}</div>"

@app.route("/dom")
def dom_xss():
    """DOM-based XSS test endpoint'i"""
    return """
    <div id="output"></div>
    <script>
        var input = new URLSearchParams(window.location.search).get('input');
        document.getElementById('output').innerHTML = input;
    </script>
    """

@app.route("/stored", methods=['GET', 'POST'])
def stored_xss():
    """Stored XSS test endpoint'i"""
    if request.method == 'POST':
        comment = request.form.get('comment', '')
        with open('comments.txt', 'a') as f:
            f.write(comment + '\n')
        
    comments = []
    try:
        with open('comments.txt', 'r') as f:
            comments = f.readlines()
    except FileNotFoundError:
        pass
    
    return f"""
    <form method="POST">
        <textarea name="comment"></textarea>
        <button type="submit">Gönder</button>
    </form>
    <div>
        {''.join(comments)}
    </div>
    """

if __name__ == "__main__":
    app.run(debug=True, port=5001) 